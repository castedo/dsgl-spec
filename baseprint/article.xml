<article>
  <front>
    <article-meta>
      <title-group>
        <article-title>Document Succession Git Layout</article-title>
      </title-group>
      <contrib-group>
        <contrib contrib-type="author">
          <contrib-id contrib-id-type="orcid">https://orcid.org/0000-0002-5014-4809</contrib-id>
          <name>
            <surname>Ellerman</surname>
            <given-names>E. Castedo</given-names>
          </name>
          <email>castedo@castedo.com</email>
        </contrib>
      </contrib-group>
      <permissions>
        <copyright-statement>&#169; 2024, Ellerman et al</copyright-statement>
        <license>
          <license-ref content-type="ccbylicense">https://creativecommons.org/licenses/by/4.0/</license-ref>
          <license-p>This document is distributed under a Creative Commons Attribution 4.0 International license.</license-p>
        </license>
      </permissions>
      <abstract>
        <p><b>DOCUMENT TYPE</b>: Living Technical Specification</p>
        <p>A document succession is a distributed, correctable document that preserves document
snapshots as editions, which can be individually referenced.
The Document Succession Git Layout (DSGL) is a format for storing document successions
within a Git object store.
DSGL bridges two related formats: the textual representation of
<a rel="external" href="https://perm.pub/1wFGhvmv8XZfPx0O5Hya2e9AyXo">Document Succession Identifiers (DSI)</a>
and the storage format for document snapshots.
An example of a snapshot format is the format for Baseprint document snapshots;
however, this specification does not define any specific format for document snapshots.</p>
      </abstract>
    </article-meta>
  </front>
  <article-body>
    <section id="background">
      <h2>Background</h2>
      <p>Websites like <a rel="external" href="https://perm.pub">https://perm.pub</a>
  use free open-source software, such as the Python package
  <a rel="external" href="https://gitlab.com/perm.pub/epijats">Epijats</a>,
  to process the formats of
  Document Succession Git Layout (DSGL),
  <a rel="external" href="https://perm.pub/1wFGhvmv8XZfPx0O5Hya2e9AyXo">Document Succession Identifiers (DSI)</a>,
  and Baseprint document snapshots.
  For the motivation behind these technologies,
  refer to <a rel="external" href="https://perm.pub/wk1LzCaCSKkIvLAYObAvaoLNGPc">Why Publish Baseprint Document Successions</a>.
  Tutorials and introductory materials are also available at
  <a rel="external" href="https://try.perm.pub">https://try.perm.pub/</a>.</p>
    </section>
    <section id="scope">
      <h2>Scope</h2>
      <p>This document is a specification of DSGL for interoperability with the following
  reference implementations:</p>
      <ul>
        <li>
          <p>the Python package <a rel="external" href="https://pypi.org/project/hidos/">Hidos</a> version 1.3<sup>
              <xref rid="ref-hidosU003A1.3" ref-type="bibr">1</xref>
            </sup> and</p>
        </li>
        <li>
          <p>the <a rel="external" href="https://manual.perm.pub">Document Succession Highly Manual Toolkit</a><sup>
              <xref rid="ref-dshmtm" ref-type="bibr">2</xref>
            </sup>.</p>
        </li>
      </ul>
      <p>This specification excludes potential DSGL features that are not implemented in
  any software.
  The online forum <a rel="external" href="https://baseprints.singlesource.pub">https://baseprints.singlesource.pub</a> is available for proposals
  of improvements to this living specification and its reference implementations.</p>
      <p>DSI in this specification refers to <a rel="external" href="https://perm.pub/1wFGhvmv8XZfPx0O5Hya2e9AyXo/2">edition 2 of the Document Succession
  Identifier specification</a>.</p>
      <section id="signed-successions">
        <h3>Signed Successions</h3>
        <p>This specification focuses on document successions that are digitally signed.
    <i>Unsigned</i> document successions fall outside the scope of this edition of the
    DSGL specification.
    While unsigned document successions may be useful for testing and learning,
    they are not essential for interoperability.</p>
      </section>
      <section id="ungarbled-successions">
        <h3>Ungarbled Successions</h3>
        <p>This specification defines DSGL for <i>ungarbled</i> recordings.
    These <i>ungarbled</i> recordings, which have a simple and intuitive format, are most likely to interoperate.
    Reality and non-ideal circumstances sometimes result in <i>garbled</i> recordings,
    which software may handle with varying degrees of success.
    This specification assumes document successions are <i>ungarbled</i>, unless otherwise noted.</p>
      </section>
    </section>
    <section id="informal-description">
      <h2>Informal Description</h2>
      <section id="initial-git-commit">
        <h3>Initial Git Commit</h3>
        <p>A document succession consists of a Git commit history with a single initial commit.
    The base DSI of the document succession is the base64url (RFC 4648)<sup>
            <xref rid="ref-rfc4648" ref-type="bibr">3</xref>
          </sup>
    representation of the 20-byte binary Git hash of the initial commit.
    An <i>ungarbled</i> document succession has a linear Git commit history.</p>
      </section>
      <section id="signatures">
        <h3>Signatures</h3>
        <p>Every Git commit tree in DSGL contains a <tt>signed_succession</tt> subdirectory
    that includes an <tt>allowed_signers</tt> file listing the public keys
    allowed to extend the document succession.
    Each non-initial commit is signed with an SSH key listed in the <tt>allowed_signers</tt> files of
    all its parent commits.</p>
        <p><b>Example</b>: Initial Git commit in DSGL.</p>
        <blockquote>
          <p><a rel="external" href="https://github.com/document-succession/1wFGhvmv8XZfPx0O5Hya2e9AyXo/commit/d7014686f9aff1765f3f1d0ee47c9ad9ef40c97a">https://github.com/document-succession/1wFGhvmv8XZfPx0O5Hya2e9AyXo/commit/d7014686f9aff1765f3f1d0ee47c9ad9ef40c97a</a></p>
        </blockquote>
        <blockquote>
          <p><a rel="external" href="https://archive.softwareheritage.org/swh:1:rev:d7014686f9aff1765f3f1d0ee47c9ad9ef40c97a">https://archive.softwareheritage.org/swh:1:rev:d7014686f9aff1765f3f1d0ee47c9ad9ef40c97a</a></p>
        </blockquote>
      </section>
      <section id="document-snapshot">
        <h3>Document Snapshot</h3>
        <p>A document snapshot in DSGL is a digital object
    that can be encoded as either a Git blob or a Git tree.
    The contents of each document snapshot are stored in an entry named <tt>object</tt> within a
    containing Git tree.
    The full path from the Git commit tree mirrors the edition number,
    with slashes separating integers instead of periods.
    For example,
    the directory containing the contents of a document snapshot for edition 2.1
    would be stored in a Git tree at the path <tt>2/1/object</tt>.</p>
        <p><b>Example</b>: Git commit tree of document succession with edition 2.1.</p>
        <blockquote>
          <p><a rel="external" href="https://github.com/document-succession/1wFGhvmv8XZfPx0O5Hya2e9AyXo/tree/f174a4f4cc3076b0f46980878c4208cbfcdb990b">https://github.com/document-succession/1wFGhvmv8XZfPx0O5Hya2e9AyXo/tree/f174a4f4cc3076b0f46980878c4208cbfcdb990b</a></p>
        </blockquote>
        <blockquote>
          <p><a rel="external" href="https://archive.softwareheritage.org/swh:1:dir:361534f2bcf78e6312a32916469e4720c7c9bb6f">https://archive.softwareheritage.org/swh:1:dir:361534f2bcf78e6312a32916469e4720c7c9bb6f</a></p>
        </blockquote>
      </section>
    </section>
    <section id="formal-definitions">
      <h2>Formal Definitions</h2>
      <section id="criteria-for-a-document-succession-in-dsgl">
        <h3>Criteria for a Document Succession in DSGL</h3>
        <p><b>Criterion</b>:
    The data of a document succession are fully recorded by a connected graph of Git commit
    records.</p>
        <p><b>Criterion</b>:
    There is only one initial Git commit (a commit without parents) in the graph of Git
    commit records. The 20-byte binary hash of this initial Git commit is the hash
    used for the base DSI of the document succession.</p>
        <p><b>Criterion</b>:
    All document snapshots are stored as a Git blob or Git tree with the name <tt>object</tt>
    (in its containing Git tree).</p>
        <p><b>Criterion</b>:
    The Git tree containing an <tt>object</tt> entry is not
    the top-level Git commit tree and is named with a positive integer.</p>
        <p><b>Criterion</b>:
    The full path to the containing tree of an <tt>object</tt> entry for a document snapshot
    consists of non-negative integers separated by slashes.
    These non-negative integers correspond to the non-negative integers separated
    by periods in the DSI.</p>
        <p><b>Criterion</b>:
    The document snapshot assigned to an edition number is the first Git blob or tree
    committed to an <tt>object</tt> entry following the path corresponding to the edition number.
    Any subsequent <tt>object</tt> entries at this path do not change the DSI assignment.</p>
      </section>
      <section id="criteria-for-a-signed-document-succession-in-dsgl">
        <h3>Criteria for a <b>Signed</b> Document Succession in DSGL</h3>
        <p><b>Criterion</b>:
    The Git tree of every Git commit record has an <tt>allowed_signers</tt> file within the
    <tt>signed_succession</tt> directory.</p>
        <p><b>Criterion</b>:
    The <tt>allowed_signers</tt> file consists of zero or more lines of four fields separated by
    space.
    The second field is <tt>namespaces="git"</tt>,
    the third field is an OpenSSH compatible key type, and the fourth field is a
    base64-encoded public key.</p>
        <p><b>Criterion</b>:
    Every commit with parents is signed with an SSH key with the public key
    listed in the <tt>allowed_signers</tt> file of all parent commits.</p>
      </section>
      <section id="criteria-for-an-ungarbled-document-succession-in-dsgl">
        <h3>Criteria for an <b>Ungarbled</b> Document Succession in DSGL</h3>
        <p><b>Criterion</b>:
    The graph of Git commit records is linear.</p>
        <p><b>Criterion</b>:
    The initial commit is signed with an SSH key that is listed in the <tt>allowed_signers</tt>
    file within the <tt>signed_succession</tt> directory.</p>
        <p><b>Criterion</b>:
    The first field of all lines in the <tt>allowed_signers</tt> files is the character <tt>*</tt>.</p>
        <p><b>Criterion</b>:
    The third field of all lines in the <tt>allowed_signers</tt> files is the key type
    <tt>ssh-ed25519</tt>.</p>
        <p><b>Criterion</b>:
    All paths of all Git commit trees match the EBNF grammar for DSGL Paths (definition
    follows).</p>
        <p><b>Criterion</b>:
    Every <tt>object</tt> entry is only added once in the commit history.</p>
        <p><b>Criterion</b>:
    There are no two <tt>object</tt> entries whose paths correspond to edition numbers that are
    above or below each other (for example, <tt>1/object</tt> and <tt>1/2/object</tt> are not both
    present).
    In other words,
    if a Git tree directly contains an <tt>object</tt> entry,
    then it is the only direct entry in that Git tree.</p>
      </section>
      <section id="dsgl-paths-in-extended-backusnaur-form-ebnf">
        <h3>DSGL Paths in Extended Backus&#8212;Naur Form (EBNF)</h3>
        <p>The following grammar is expressed in ISO/IEC 14977
    <a rel="external" href="https://en.wikipedia.org/wiki/Extended_Backus%E2%80%93Naur_form">Extended Backus&#8212;Naur Form (EBNF)</a>
    extended further to allow an ellipsis (<tt>&#8230;</tt>) to denote a range of ASCII characters.</p>
        <pre>path = "signed_succession/allowed_signers" | snapshot ;
snapshot = { non_neg_int, "/" }, pos_int, "/object" ;
non_neg_int = "0" | pos_int ;
pos_int = pos_dec_digit, { dec_digit } ;
dec_digit = "0" | pos_dec_digit ;
pos_dec_digit = "1"&#8230;"9" ;</pre>
      </section>
    </section>
    <section id="discussion">
      <h2>Discussion</h2>
      <section id="control-of-document-successions">
        <h3>Control of Document Successions</h3>
        <p>As long as authors of document successions maintain control over the allowed private SSH
    signing keys,
    a signed document succession can be moved and distributed across any Git-compatible servers,
    yet only the authors can extend the document succession with new editions.
    The capability to extend a signed document succession hinges on control of allowed private SSH signing keys,
    rather than control over specific accounts or servers.</p>
      </section>
      <section id="related-concepts">
        <h3>Related Concepts</h3>
        <p>A <i>Document Succession Identifier</i> is an
    <a rel="external" href="https://www.softwareheritage.org/2020/07/09/intrinsic-vs-extrinsic-identifiers">intrinsic identifier</a><sup>
            <xref rid="ref-intrinsic_extrinsic_identifiers" ref-type="bibr">4</xref>
          </sup> <sup>
            <xref rid="ref-cosmo_referencing_2020" ref-type="bibr">5</xref>
          </sup><sup>
            <xref rid="ref-dicosmoU003Ahal-01865790" ref-type="bibr">6</xref>
          </sup>
    of the initial Git commit.</p>
      </section>
      <section id="design-choice-rationales">
        <h3>Design Choice Rationales</h3>
        <section id="separation-of-git-history-from-edition-history">
          <h4>Separation of Git History from Edition History</h4>
          <p>Representing the history of editions through means other than Git commit history
      is a deliberate design choice.
      Git commit history records all Git actions,
      which can lead to inflexible and complicated non-linear histories.
      Software Heritage automatically preserves Git commits,
      increasing the risk that a Git commit history could become
      an unintended complicated non-linear history.
      Non-linear Git commit histories and merge commits might be useful in certain scenarios.</p>
          <p>Separating edition history from Git commit history also allows
      for future enhancements, such as retracting specific editions.</p>
        </section>
        <section id="use-of-git-tree-paths-instead-of-git-tags">
          <h4>Use of Git Tree Paths Instead of Git Tags</h4>
          <p>In document successions, edition numbers are akin to software release versions,
      which are typically identified using Git tags.
      However, this specification adopts a different approach.
      Edition numbers are recorded with file paths in Git trees rather than Git tags.
      With this approach, a single latest Git commit captures a complete record of a document succession.
      This means copying document successions is as easy as copying Git branches.
      This is especially useful when consolidating records from multiple sources into a single Git repository.</p>
          <p>In contrast, software projects, which often include release tags,
      are copied by cloning the entire repository.
      Using Git tags for edition numbers would
      introduce the complexity of keeping a branch and edition number tags in sync,
      thereby increasing the risk of problems during copying.</p>
          <p>While branches in Git repositories are useful for managing document successions,
      branch names do not constitute a part of the document succession record.</p>
        </section>
      </section>
    </section>
    <section id="acknowledgments">
      <h2>Acknowledgments</h2>
      <p>Thank you to Valentin Lorentz for raising questions about design choices
  and pointing out an important shortcoming in how GPG digital signatures were used
  in the initial Git implementation of the Hidos library (version 0.3)<sup>
          <xref rid="ref-hidosU003A0.3" ref-type="bibr">7</xref>
        </sup>.</p>
      <p>This document has been copyedited with AI using <a rel="external" href="https://copyaid.it">https://copyaid.it</a>.</p>
    </section>
    <section id="history">
      <h2>History</h2>
      <ul>
        <li>
          <p>Copied Git storage specifics from <a rel="external" href="https://perm.pub/1wFGhvmv8XZfPx0O5Hya2e9AyXo/2.1">edition 2.1 of the DSI
      specification</a>.</p>
        </li>
      </ul>
    </section>
  </article-body>
  <back>
    <ref-list>
      <ref id="ref-hidosU003A1.3">
        <element-citation>
          <person-group person-group-type="author">
            <string-name>Hidos contributors</string-name>
          </person-group>
          <article-title>Hidos 1.3</article-title>
          <year>2024</year>
          <uri>https://archive.softwareheritage.org/swh:1:rev:0c997b13a255be2a83f150371c9364a1217fa91a;origin=https://gitlab.com/perm.pub/hidos</uri>
        </element-citation>
      </ref>
      <ref id="ref-dshmtm">
        <element-citation>
          <person-group person-group-type="author">
            <string-name>DSHMTM contributors</string-name>
          </person-group>
          <article-title>Document succession highly manual toolkit manual</article-title>
          <year>2024</year>
          <uri>https://archive.softwareheritage.org/swh:1:rev:f6da04dce5f53d88c4c324c1d2546110a8d42d8a;origin=https://gitlab.com/perm.pub/dshmtm</uri>
        </element-citation>
      </ref>
      <ref id="ref-rfc4648">
        <element-citation>
          <person-group person-group-type="author">
            <name>
              <surname>Josefsson</surname>
              <given-names>S.</given-names>
            </name>
          </person-group>
          <article-title>The Base16, Base32, and Base64 data encodings</article-title>
          <year>2006</year>
          <month>10</month>
          <publisher-name>RFC Editor; Internet Requests for Comments; RFC Editor</publisher-name>
          <issn>2070-1721</issn>
          <uri>https://www.rfc-editor.org/info/rfc4648</uri>
          <pub-id pub-id-type="doi">10.17487/RFC4648</pub-id>
        </element-citation>
      </ref>
      <ref id="ref-intrinsic_extrinsic_identifiers">
        <element-citation>
          <person-group person-group-type="author">
            <name>
              <surname>Heritage</surname>
              <given-names>Software</given-names>
            </name>
          </person-group>
          <article-title>Intrinsic and extrinsic identifiers</article-title>
          <year>2020</year>
          <uri>https://web.archive.org/web/20221019201056/https://www.softwareheritage.org/2020/07/09/intrinsic-vs-extrinsic-identifiers/</uri>
        </element-citation>
      </ref>
      <ref id="ref-cosmo_referencing_2020">
        <element-citation>
          <person-group person-group-type="author">
            <name>
              <surname>Cosmo</surname>
              <given-names>Roberto Di</given-names>
            </name>
            <name>
              <surname>Gruenpeter</surname>
              <given-names>Morane</given-names>
            </name>
            <name>
              <surname>Zacchiroli</surname>
              <given-names>Stefano</given-names>
            </name>
          </person-group>
          <article-title>Referencing Source Code Artifacts: A Separate Concern in Software Citation</article-title>
          <source-title>Computing in Science &amp; Engineering</source-title>
          <year>2020</year>
          <month>03</month>
          <date-in-citation content-type="access-date">
            <year>2022</year>
            <month>09</month>
            <day>05</day>
          </date-in-citation>
          <volume>22</volume>
          <issue>2</issue>
          <fpage>33</fpage>
          <lpage>43</lpage>
          <issn>1521-9615, 1558-366X</issn>
          <uri>https://ieeexplore.ieee.org/document/8946737/</uri>
          <pub-id pub-id-type="doi">10.1109/MCSE.2019.2963148</pub-id>
        </element-citation>
      </ref>
      <ref id="ref-dicosmoU003Ahal-01865790">
        <element-citation>
          <person-group person-group-type="author">
            <name>
              <surname>Di Cosmo</surname>
              <given-names>Roberto</given-names>
            </name>
            <name>
              <surname>Gruenpeter</surname>
              <given-names>Morane</given-names>
            </name>
            <name>
              <surname>Zacchiroli</surname>
              <given-names>Stefano</given-names>
            </name>
          </person-group>
          <article-title>Identifiers for Digital Objects: the Case of Software Source Code Preservation</article-title>
          <source-title>iPRES 2018 - 15th International Conference on Digital Preservation</source-title>
          <year>2018</year>
          <month>09</month>
          <publisher-loc>Boston, United States</publisher-loc>
          <fpage>1</fpage>
          <lpage>9</lpage>
          <uri>https://hal.archives-ouvertes.fr/hal-01865790</uri>
        </element-citation>
      </ref>
      <ref id="ref-hidosU003A0.3">
        <element-citation>
          <person-group person-group-type="author">
            <string-name>Hidos contributors</string-name>
          </person-group>
          <article-title>Hidos 0.3</article-title>
          <year>2022</year>
          <uri>https://archive.softwareheritage.org/swh:1:rev:b963e5d2366724df6e8c34d864a7984ce4a2e1be;origin=https://gitlab.com/perm.pub/hidos</uri>
        </element-citation>
      </ref>
    </ref-list>
  </back>
</article>
